<!-- 骨架屏 -->
<import src="skeleton.wxml" />
<template is="skeleton" wx:if="{{skeletonLoading}}" />
<!-- 主体 -->
<view wx:else="{{skeletonLoading}}" class="page-wrapper">
  <view class="page-head filter-bar">
    <t-row>
      <t-col span="24">
        <t-dropdown-menu>
          <t-dropdown-item options="{{dropdownMaterial.options}}" placement="right" value="{{dropdownMaterial.value}}" bindchange="onMaterialChange" />
          <t-dropdown-item options="{{dropdownSorter.options}}" placement="right" value="{{dropdownSorter.value}}" bindchange="onSorterChange" />
        </t-dropdown-menu>
      </t-col>
    </t-row>
  </view>
  <view class="page-main">
    <view class="wrapper">
      <view class="cell" wx:for="{{Data}}" wx:key="index" wx:for-index="outerIndex">
        <view class="arrange-space-between title-font-main">
          <text>Title：{{ item.title }}</text>
        </view>
        <view class="arrange-space-between title-font-other">
          <text style="border-bottom: 1px solid currentColor;">Material：{{ item.texture }}</text>
        </view>
        <view class="title-font-other arrange-space-between">
          <text>Name：{{ item.name }}</text>
          <text>Code：{{ item.code }}</text>
        </view>
        <view class="cell-swiper">
          <!-- <t-swiper wx:if="{{swiperImages.length}}" current="{{current}}" autoplay="{{autoplay}}" duration="{{duration}}" interval="{{interval}}" navigation="{{ { type: 'dots' } }}" list="{{swiperImages}}" bind:click="onSwiperImagesTap" data-images="{{swiperImages}}">
          </t-swiper> -->
          <swiper wx:if="{{item.picture_list.length}}" autoplay="{{false}}" interval="3000" duration="500" circular="{{false}}" indicator-dots="{{true}}" indicator-color="#ccc" indicator-active-color="#fff" style="width: 690rpx;height:384rpx ;">
            <block wx:for="{{item.picture_list}}" wx:key="index">
              <swiper-item>
                <image src="{{item}}" mode="widthFix" style="width:55%;display: block; margin: 0 auto; " bindtap="onSwiperImagesTap" data-outer-index="{{outerIndex}}" data-index="{{index}}" />
              </swiper-item>
            </block>
          </swiper>
          <!-- 无数据时显示占位内容 -->
          <t-image wx:else src="" shape="round" error="slot" width="640rpx" height="384rpx">
            <text class="error-text" slot="error">轮播图加载失败</text>
          </t-image>
        </view>
        <view class="arrange-center title-font-other">
          <text class="title-font-main">时间线：</text>
          <t-link size="small" content="查看历史时间线" hover underline variant="outline" bind:tap="onOpenHistoryTimeLine" data-task-id="{{ item.id }}" />
        </view>
        <view class="collapse-wrapper">
          <t-collapse>
            <t-collapse-panel value="0" expandIcon>
              <view slot="header">
                <text class="title-font-main">阶段展示</text>
              </view>
              <view class="steps">
                <t-steps layout="vertical" readonly theme="dot" current="{{10}}">
                  <!-- kyle初选 -->
                  <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">初步评审：</text>
                    </view>
                    <view class="steps-content arrange-column" slot="content">
                      <text class="status-font">图稿状态：{{ item.confirmed_text_1 }}</text>
                    </view>
                  </t-step-item>
                  <!-- 可行性分析 shelley -->
                  <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">Shelley可行性分析</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">评估建议：{{ item.confirmed2_text }}</text>
                    </view>
                  </t-step-item>
                  <!-- 可行性分析 fmr -->
                  <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">FMR可行性分析</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">评估建议：{{ item.fmr2_text }}</text>
                      <t-divider layout="vertical" />
                      <text class="status-font">指派FMR：{{ item.fmr }}</text>
                    </view>
                  </t-step-item>
                  <!-- AIT改稿 -->
                  <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">AIT改稿</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">设计师：{{ item.AIT_designer1 }}</text>
                      <t-divider layout="vertical" />
                      <text class="status-font">状态：{{ item.AIT_designer2 }}</text>
                    </view>
                  </t-step-item>
                  <!-- AIT改稿确认 -->
                  <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">AIT改稿确认</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">审核人：{{ item.AIT_manager1 }}</text>
                      <t-divider layout="vertical" />
                      <text class="status-font">状态：{{ item.AIT_manager2 }}</text>
                    </view>
                  </t-step-item>
                  <!-- 最终创意审查 -->
                  <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">最终创建审查：</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">评审建议：{{ item.confirmed_text_2 }}</text>
                    </view>
                  </t-step-item>
                  <!-- 第一轮选稿 -->
                  <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">第一轮客户选稿：</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">状态：{{ item.be_chosen2_text}}</text>
                      <t-divider layout="vertical" />
                      <text class="status-font">是否上传工厂稿：{{ item.whether_to_proof_text}}</text>
                    </view>
                  </t-step-item>
                  <!-- 设计师工厂稿 -->
                  <!-- <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">工厂稿：</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">状态：已上传</text>
                      <t-divider layout="vertical" />
                      <t-link size="small" content="预览" hover underline />
                    </view>
                  </t-step-item> -->
                  <!-- fmr上传样品图片 -->
                  <!-- <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">样品图：</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">状态：已上传</text>
                      <t-divider layout="vertical" />
                      <t-link size="small" content="预览" hover underline />
                    </view>
                  </t-step-item> -->
                  <!-- 第二轮选稿 -->
                  <t-step-item>
                    <view class="steps-title" slot="title">
                      <text class="title-font-main">第二轮客户选稿：</text>
                    </view>
                    <view class="steps-content arrange-center" slot="content">
                      <text class="status-font">状态：{{ item.be_ordered2_text }}</text>
                    </view>
                  </t-step-item>
                </t-steps>
              </view>
            </t-collapse-panel>
          </t-collapse>
        </view>
      </view>
    </view>
  </view>
  <!-- 当下拉时,进行显示的内容  -->
  <view class="loading-box loading-flex" wx:if="{{isLoadingReachMore}}">
    <!-- <text class="loading-text">加载中...</text> -->
    <t-loading theme="dots" size="60rpx" />
  </view>
  <view class="loading-box" wx:if="{{noMoreData}}">
    <text class="loading-text">-- 已经到底了 --</text>
  </view>

</view>
<!-- 轻提示 -->
<t-toast id="t-toast" />
<!-- 回到顶部 -->
<t-back-top theme="half-round" text="顶部" scroll-top="{{scrollTop}}" bind:to-top="onToTop" />
<!-- 查看自评弹窗 -->
<t-popup visible="{{popupVisible}}" bind:visible-change="onClosePopup" placement="bottom">
  <view class="popup-block">
    <view class="popup-header">
      <view class="popup-title">{{popupTitle}}：</view>
    </view>
    <view class="popup-comments">
      <text>{{ popupValue }}</text>
    </view>
  </view>
</t-popup>
<!-- 抽屉/展示时间线 -->
<t-popup visible="{{popupTimeLineVisible}}" placement="left">
  <view class="popup-block" style="padding: 10rpx;height: 100%;">
    <view class="popup-header arrange-column">
      <view class="popup-title">时间线历史：</view>
    </view>
    <view class="popup-comments">
      <scroll-view scroll-y style="height: calc(100% - 120rpx);padding: 0 20rpx;" class="popup-comments" bindtouchmove="onDummyTouchMove" catchtouchmove>
        <view wx:for="{{timeLineValue}}" wx:key="index" style="width: 93%;">
          <view class="arrange-space-between">
            <view class="arrange-center">
              <text class="title-font-main">类型：</text>
              <text class="title-font-other">{{item.timeline_type_text}}</text>
            </view>
            <view class="arrange-center">
              <text class="title-font-main">评论人：</text>
              <text class="title-font-other">{{item.name}}</text>
            </view>
          </view>
          <view class="cell-swiper" style="margin-top: 20rpx;">
            <!-- <t-swiper wx:if="{{item.picture_list.length}}" autoplay="{{false}}" duration="{{500}}" navigation="{{ { type: 'dots' } }}" list="{{item.picture_list}}" bind:click="onSwiperImagesTap" data-images="{{item.picture_list}}">
            </t-swiper> -->
            <swiper wx:if="{{item.picture_list.length}}" autoplay="{{false}}" interval="3000" duration="500" circular="{{false}}" indicator-dots="{{true}}" indicator-color="#ccc" indicator-active-color="#fff" style="width: 690rpx;height:384rpx ;">
              <block wx:for="{{item.picture_list}}" wx:key="index">
                <swiper-item>
                  <image src="{{item}}" mode="widthFix" style="width:55%;display: block; margin: 0 auto; " />
                </swiper-item>
              </block>
            </swiper>
            <!-- 无数据时显示占位内容 -->
            <t-image wx:else src="" shape="round" error="slot" width="660rpx" height="384rpx">
              <text class="error-text" slot="error">图片加载失败</text>
            </t-image>
          </view>
          <view class="arrange-column" style="margin-top: 20rpx;">
            <view class="arrange-space-between">
              <text class="title-font-main">评论内容：</text>
              <view class="arrange-center">
                <text class="title-font-main">评论时间：</text>
                <text class="title-font-other">{{item.time}}</text>
              </view>
            </view>
            <text class="title-font-other" style="margin-left: 20rpx;font-size:14px">{{item.comment}}</text>
          </view>

          <t-divider content="时间线-{{index+1}}" />
        </view>
      </scroll-view>
      <view class="button-example" style="padding: 10rpx 0;">
        <t-button theme="light" block t-class="group-btn" bindtap="onCloseHistoryTimeLine">关闭</t-button>
      </view>
    </view>
  </view>
</t-popup>